<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Axe showcase</title>

    <!-- Babylon.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        #preloader {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column; /* Stack the loader and the text vertically */
}

        /* Create a spinning loader */
        #loader {
            border: 16px solid #f3f3f3;
            border-top: 16px solid #3498db;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: spin 2s linear infinite;
            margin-bottom: 20px; /* Add some space between the loader and the text */
        }

        /* Spin animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loader-text {
            color: #fff;
            font-size: 40px;
            text-align: center;
        }

    </style>
</head>


<body>
    <!-- Preloader -->
    <div id="preloader">
        <div id="loader"></div>
        <p id="loader-text">Loading, the 3D models can take a while to show up. Thanks for waiting.</p>
    </div>

    <canvas id="renderCanvas"></canvas>
    <script>

         // Hide the preloader after the page has loaded
        window.addEventListener('load', function () {
        document.getElementById('preloader').style.display = 'none';
        });

        var canvas = document.getElementById("renderCanvas");

        var startRenderLoop = function (engine, canvas) {
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        }

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function () { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, disableWebGL2Support: false }); };
        var createScene = function () {
            // This creates a basic Babylon Scene object (non-mesh)
            var scene = new BABYLON.Scene(engine);

            // This creates and positions a free camera (non-mesh)
            var camera = new BABYLON.ArcRotateCamera("Camera", 1, 1.5, 10, BABYLON.Vector3.Zero(), scene);

            // This attaches the camera to the canvas
            camera.attachControl(canvas, true);

            //Mouse wheel speed
            camera.wheelPrecision = 50;

            //Mouse wheel zoom range
            //Zoom-in limit
            camera.lowerRadiusLimit = 2.75;
            //Zoom-out limit
            camera.upperRadiusLimit = 8;

            //Create initial mesh variables. 
            var mesh1;
            var mesh2;
            var mesh3;
            var mesh4;

            var promises = [];

            // First mesh import
            promises.push(new Promise(function (resolve) {
                BABYLON.SceneLoader.ImportMesh("", "3dmodels/", "Axe1.2.glb", scene, function (axe1) {
                    mesh1 = axe1[0];
                    mesh1.position.z = 4;
                    resolve();
                });
            }));

            // Import second mesh
            promises.push(new Promise(function (resolve) {
                BABYLON.SceneLoader.ImportMesh("", "3dmodels/", "Axe2.glb", scene, function (axe2) {
                    mesh2 = axe2[0];
                    resolve();
                });
            }));

            // Import third mesh
            promises.push(new Promise(function (resolve) {
                BABYLON.SceneLoader.ImportMesh("", "3dmodels/", "Axe3.glb", scene, function (axe3) {
                    mesh3 = axe3[0];
                    mesh3.position.z = -4;
                    resolve();
                });
            }));

            // Import mammoth tooth
            promises.push(new Promise(function (resolve) {
                BABYLON.SceneLoader.ImportMesh("", "3dmodels/", "mammoth_tooth.glb", scene, function (tooth) {
                    mesh4 = tooth[0];
                    mesh4.position.x = -4;
                    mesh4.position.y = -1;
                    resolve();
                });
            }));

            // Import iron cast
            promises.push(new Promise(function (resolve) {
                BABYLON.SceneLoader.ImportMesh("", "3dmodels/", "iron_final1.glb", scene, function (tooth) {
                    mesh5 = tooth[0];
                    mesh5.position.x = 4;
                    resolve();
                });
            }));

            // Wait for all promises to resolve
            Promise.all(promises).then(function () {
                // All models have loaded into memory, now wait for the scene to be ready
                scene.executeWhenReady(function () {
                    // The scene is ready, hide the preloader
                    document.getElementById('preloader').style.display = 'none';
                });
            });

            // Spheres for the UI buttons to focus on 
            var sphere1 = BABYLON.Mesh.CreateSphere("sphere1", 16, 1, scene);
            sphere1.isVisible = false;
            sphere1.position.y = 0;
            sphere1.position.z = 4;
            sphere1.position.x = 0;

            var sphere2 = BABYLON.Mesh.CreateSphere("sphere2", 16, 1, scene);
            sphere2.isVisible = false;
            sphere2.position.y = 0;
            sphere2.position.z = 0;
            sphere2.position.x = 0;

            var sphere3 = BABYLON.Mesh.CreateSphere("sphere3", 16, 1, scene);
            sphere3.isVisible = false;
            sphere3.position.y = 0;
            sphere3.position.z = -4;
            sphere3.position.x = 0;

            var sphere4 = BABYLON.Mesh.CreateSphere("sphere4", 16, 1, scene);
            sphere4.isVisible = false;
            sphere4.position.y = 0;
            sphere4.position.z = 0;
            sphere4.position.x = -4;            

            var sphere5 = BABYLON.Mesh.CreateSphere("sphere5", 16, 1, scene);
            sphere5.isVisible = false;
            sphere5.position.y = 0;
            sphere5.position.z = 0;
            sphere5.position.x = 4;  

           // HDRIs
            var hdrTextures = [
                new BABYLON.CubeTexture("textures/outside.env", scene),
                new BABYLON.CubeTexture("textures/outside2.env", scene),
                new BABYLON.CubeTexture("textures/studio.env", scene),
                new BABYLON.CubeTexture("textures/bluesky.env", scene),
                new BABYLON.CubeTexture("textures/trees.env", scene),
                new BABYLON.CubeTexture("textures/landscape.env", scene),
            ];

            // Start with the first texture
            var currentTextureIndex = 0;
            var sky = scene.createDefaultSkybox(hdrTextures[currentTextureIndex], true, 1000, 0.3);

            // Create a button
            var advancedTexture6 = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

            var button = document.createElement("button");
            button.innerHTML = "Change background";
            button.style.position = "fixed";
            button.style.top = "50%";
            button.style.transform = "translateY(-50%)";    
            button.style.borderRadius = "14px"; 
            button.style.border = "4px solid white";
            button.style.right = "0px";
            button.style.margin = "25px";

            button.style.width = "110px";    
            button.style.height = "60px";   

            button.style.backgroundColor = "black";
            button.style.color = "white";

            document.body.appendChild(button);


            // Switch to the next HDRI when the button is clicked
            button.addEventListener("click", function () {
                // Dispose of the old skybox
                sky.dispose();

                // Switch to the next HDRI
                currentTextureIndex = (currentTextureIndex + 1) % hdrTextures.length;

                // Create a new skybox with the new HDRI
                sky = scene.createDefaultSkybox(hdrTextures[currentTextureIndex], true, 1000, 0.3);
            });


            //var hdrTexture = new BABYLON.CubeTexture("textures/outside.env", scene);
            //var sky = scene.createDefaultSkybox(hdrTexture, true);

            // GUI
            var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"); //Axe 1 button
            var advancedTexture2 = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"); //Axe 2 button
            var advancedTexture3 = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"); //Axe 3 button
            var advancedTexture4 = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"); //Tooth button
            var advancedTexture5 = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI"); //Iron object button

            //Button A
            var buttonA = BABYLON.GUI.Button.CreateImageOnlyButton("", "textures/clickme.png");
            advancedTexture.addControl(buttonA);

            buttonA.width = "35px"
            buttonA.height = "35px";
            buttonA.cornerRadius = 30;
            buttonA.background = "transparent";
            buttonA.linkWithMesh(sphere1);

            //Button Funtionality
            buttonA.onPointerEnterObservable.add(function () {
                buttonA.background = "grey";
            });
            buttonA.onPointerOutObservable.add(function () {
                buttonA.background = "transparent";
            });
            buttonA.onPointerUpObservable.add(function () {
                camera.target = sphere1;
            });

            //Button B
            var buttonB = BABYLON.GUI.Button.CreateImageOnlyButton("", "textures/clickme.png");
            advancedTexture2.addControl(buttonB);
            buttonB.width = "35px"
            buttonB.height = "35px";
            buttonB.cornerRadius = 30;
            buttonB.background = "transparent";
            buttonB.linkWithMesh(sphere2);

            //Button Funtionality
            buttonB.onPointerEnterObservable.add(function () {
                buttonB.background = "grey";
            });
            buttonB.onPointerOutObservable.add(function () {
                buttonB.background = "transparent";
            });
            buttonB.onPointerUpObservable.add(function () {
                camera.target = sphere2;
            });

            //Button C
            var buttonC = BABYLON.GUI.Button.CreateImageOnlyButton("", "textures/clickme.png");
            advancedTexture3.addControl(buttonC);
            buttonC.width = "35px"
            buttonC.height = "35px";
            buttonC.cornerRadius = 30;
            buttonC.background = "transparent";
            buttonC.linkWithMesh(sphere3);

            //Button Funtionality
            buttonC.onPointerEnterObservable.add(function () {
                buttonC.background = "grey";
            });
            buttonC.onPointerOutObservable.add(function () {
                buttonC.background = "transparent";
            });
            buttonC.onPointerUpObservable.add(function () {
                camera.target = sphere3;
            });

            //Button D
            var buttonD = BABYLON.GUI.Button.CreateImageOnlyButton("", "textures/clickme.png");
            advancedTexture4.addControl(buttonD);

            buttonD.width = "35px"
            buttonD.height = "35px";
            buttonD.cornerRadius = 30;
            buttonD.background = "transparent";
            buttonD.linkWithMesh(sphere4);

            //Button Funtionality
            buttonD.onPointerEnterObservable.add(function () {
                buttonD.background = "grey";
            });
            buttonD.onPointerOutObservable.add(function () {
                buttonD.background = "transparent";
            });
            buttonD.onPointerUpObservable.add(function () {
                camera.target = sphere4;
            });

            //Button E
            var buttonE = BABYLON.GUI.Button.CreateImageOnlyButton("", "textures/clickme.png");
            advancedTexture5.addControl(buttonE);

            buttonE.width = "35px"
            buttonE.height = "35px";
            buttonE.cornerRadius = 30;
            buttonE.background = "transparent";
            buttonE.linkWithMesh(sphere5);

            //Button Funtionality
            buttonE.onPointerEnterObservable.add(function () {
                buttonE.background = "grey";
            });
            buttonE.onPointerOutObservable.add(function () {
                buttonE.background = "transparent";
            });
            buttonE.onPointerUpObservable.add(function () {
                camera.target = sphere5;
            });


            // instrctions
            const image = new BABYLON.GUI.Image("", "textures/instructions.png");
            image.width = "25%";
            image.height = "25%";
            image.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            image.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;

            // Add the image to the UI
            advancedTexture.addControl(image);


            return scene;
        };
        window.initFunction = async function () {


            var asyncEngineCreation = async function () {
                try {
                    return createDefaultEngine();
                } catch (e) {
                    console.log("the available createEngine function failed. Creating the default engine instead");
                    return createDefaultEngine();
                }
            }

            window.engine = await asyncEngineCreation();
            if (!engine) throw 'engine should not be null.';
            startRenderLoop(engine, canvas);
            window.scene = createScene();
        };
        initFunction().then(() => {
            sceneToRender = scene
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>

</html>
